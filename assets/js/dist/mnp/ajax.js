define(["jquery","mnp/controls","mnp/domSelector","mnp/field","mnp/alert","fileSaver","mnp/wpMenuPages"],function(e,t,n,r,i,s,o){var u="wp-menu-pages-",a=u+"save-options-",f=u+"reset-options-",l=u+"export-options-",c=u+"import-options-",h=u+"update-core-options-";return{ajaxUrl:ajaxurl,context:o.context,actionPrefix:"wp-menu-pages-",actionSavePrefix:a,actionResetPrefix:f,actionExportPrefix:l,actionImportPrefix:c,actionUpdateCoreOptionsPrefix:h,post:function(t,n,r,i,s){e.ajax({url:this.ajaxUrl,method:"POST",data:t,success:i,complete:n,error:r,dataType:s?s:"json"})},saveOptions:function(e){var s=this.actionSavePrefix+this.context,u={options:e,action:s,nonce:o.nonce[s]};t.loading(n.getSaveBtn(),!0,!0);var a=function(e){if(e.data!=undefined&&e.data.options!=undefined){var t=e.data.options;for(var n in t){if(!t.hasOwnProperty(n))continue;if(t[n].valid){r.markValid(n);continue}r.markInvalid(n,t[n].errors)}}return e.success==undefined||e.success==0?(i.danger("There was an error saving the options"),!1):(i.success("Options Saved!",2e3),!0)},f=function(){i.danger("There was an error saving the options")},l=function(){t.loading(n.getSaveBtn(),!1)};this.post(u,l,f,a)},exportOptions:function(){var e=this.actionExportPrefix+this.context,r={action:e,nonce:o.nonce[e]};t.loading(n.getExportBtn(),!0,!0);var u=function(e){if(e.success==undefined||e.success==0)return f(e),!1;var t=new Blob([e.data.options],{type:"application/json;charset=utf-8;"});return s(t,e.data.name+".json"),!0},a=function(){t.loading(n.getExportBtn(),!1)},f=function(){i.danger("There was an error while trying to prepare your download")};this.post(r,a,f,u)},importOptions:function(e){if(e.length==0)return;var s=this.actionImportPrefix+this.context,u={action:s,nonce:o.nonce[s],options:e};t.loading(n.getAllControls(),!0,!0);var a=function(e){return e.success==undefined||e.success==0?(l(e),!1):(i.success("Options Import Successful",2e3),e.data!=undefined&&e.data.options!=undefined&&r.updateValues(e.data.options),!0)},f=function(){t.loading(n.getAllControls(),!1)},l=function(){i.danger("There was an error while importing options")};this.post(u,f,l,a)},resetOptions:function(e){var s=this.actionResetPrefix+this.context,u={action:s,nonce:o.nonce[s]};e&&(u.include=e),t.loading(n.getResetBtn(),!0,!0),t.loading(n.getTabResetBtn(),!0,!0);var a=function(e){return e.success==undefined||e.success==0?(l(e),!1):(i.success("All Options Have Been Reset to Defaults",2e3),e.data!=undefined&&e.data.defaults!=undefined&&r.updateValues(e.data.defaults),!0)},f=function(){t.loading(n.getResetBtn(),!1),t.loading(n.getTabResetBtn(),!1)},l=function(){i.danger("There was an error reseting options")};this.post(u,f,l,a)},updateCoreOptions:function(e){var t=this.actionUpdateCoreOptionsPrefix+this.context,n={options:e,action:t,nonce:o.nonce[t]};this.post(n)}}});