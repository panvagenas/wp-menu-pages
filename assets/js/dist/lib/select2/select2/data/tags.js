define(["jquery"],function(e){function t(t,n,r){var i=r.get("tags"),s=r.get("createTag");s!==undefined&&(this.createTag=s),t.call(this,n,r);if(e.isArray(i))for(var o=0;o<i.length;o++){var u=i[o],a=this._normalizeItem(u),f=this.option(a);this.$element.append(f)}}return t.prototype.query=function(e,t,n){function i(e,s){var o=e.results;for(var u=0;u<o.length;u++){var a=o[u],f=a.children!=null&&!i({results:a.children},!0),l=a.text===t.term;if(l||f){if(s)return!1;e.data=o,n(e);return}}if(s)return!0;var c=r.createTag(t);if(c!=null){var h=r.option(c);h.attr("data-select2-tag",!0),r.addOptions([h]),r.insertTag(o,c)}e.results=o,n(e)}var r=this;this._removeOldTags();if(t.term==null||t.page!=null){e.call(this,t,n);return}e.call(this,t,i)},t.prototype.createTag=function(t,n){var r=e.trim(n.term);return r===""?null:{id:r,text:r}},t.prototype.insertTag=function(e,t,n){t.unshift(n)},t.prototype._removeOldTags=function(t){var n=this._lastTag,r=this.$element.find("option[data-select2-tag]");r.each(function(){if(this.selected)return;e(this).remove()})},t});