(function(d){var f=d.extend({actionSavePrefix:wpMenuPages.actions.actionSavePrefix,actionExportPrefix:wpMenuPages.actions.actionExportPrefix,actionImportPrefix:wpMenuPages.actions.actionImportPrefix,actionResetPrefix:wpMenuPages.actions.actionResetPrefix,actionUpdateCoreOptionsPrefix:wpMenuPages.actions.actionUpdateCoreOptionsPrefix,statesKey:"state",pageOptionsKey:"pageOptions",wpDateFormat:"F j, Y",wpTimeFormat:"g:i a",dateTimePicker:{icons:{time:"fa fa-clock-o",date:"fa fa-calendar",up:"fa fa-angle-up",down:"fa fa-angle-down",previous:"fa fa-angle-left",next:"fa fa-angle-right",today:"fa fa-crosshairs",clear:"fa fa-trash-o",close:"fa fa-times"},dateFormat:"YYYY-MM-DD",timeFormat:"HH:mm:ss",weekFormat:"ww",monthFormat:"MM"}},wpMenuPagesDefinitions);var b={readSingleFileAsText:function(q,r){var p=q.target.files[0];if(p){var o=new FileReader();o.onload=r;o.readAsText(p)}return false}};var j={ctrlSaveBtnSelector:".btn-save-options",ctrlResetBtnSelector:".btn-reset-options",ctrlTabResetBtnSelector:".btn-tab-reset-options",ctrlExportOptsSelector:".btn-export-options",ctrlImportOptsSelector:".btn-import-options",ctrlAllControlsSelector:".wp-menu-pages-control",activeTabSelector:".tab-pane.active",select2Selector:".select2.wp-menu-pages-input",getActiveTab:function(){return d(this.activeTabSelector)},getSaveBtn:function(){return d(this.ctrlSaveBtnSelector)},getResetBtn:function(){return d(this.ctrlResetBtnSelector)},getTabResetBtn:function(){return d(this.ctrlTabResetBtnSelector)},getExportBtn:function(){return d(this.ctrlExportOptsSelector)},getImportBtn:function(){return d(this.ctrlImportOptsSelector)},getAllControls:function(){return d(this.ctrlAllControlsSelector)}};var a={getActiveTabOptions:function(){var o=j.getActiveTab().find("form");return o.serialize()}};var g="help-block";var n="input-error";var m="."+g+"."+n;var i={helpBlockClass:g,helpBlockErrorClass:n,helpBlockErrorSelector:m,helpBlockTemplate:'<span id="{{id}}" class="'+g+" "+n+'">{{msg}}</span>',inputHasErrorClass:"has-error",inputStandardClass:"wp-menu-pages-input",markInvalid:function(r,s){if(typeof r=="string"){r=this.getByName(r,false)}if(s==undefined||s.length==0||!r||r.length==undefined||r.length==0){return}var p=s.join("<br />");var o=this.helpBlockTemplate.replace("{{msg}}",p).replace("{{id}}",r.attr("name")+"-error");var q=r.closest(".form-group");q.addClass(this.inputHasErrorClass);q.find(this.helpBlockErrorSelector).remove();r.after(o)},markValid:function(p){if(typeof p=="string"){p=this.getByName(p,false)}if(!p||p.length==undefined||p.length==0){return}var o=p.closest(".form-group");o.removeClass(this.inputHasErrorClass);o.find(this.helpBlockErrorSelector).remove()},getByName:function(q,p){p=p==undefined;var o=p?j.getActiveTab():d(".wp-menu-pages-ns");return o.find("."+this.inputStandardClass+"#"+q)},updateValues:function(o){if(o==undefined||o.length==0){return[]}for(var r in o){if(!o.hasOwnProperty(r)){continue}var q=o[r];var p=this.getByName(r,false);if(p==undefined||p.length==0){continue}if(p.attr("type")=="radio"){this.updateRadioValue(r,q);continue}p.val(q);p.trigger("change")}},updateRadioValue:function(o,p){d("#"+o+'[value="'+p+'"]').parent().button("toggle")},isSelect2:function(p){var o=p instanceof jQuery?p:this.getByName(p,false);if(o&&o.length>0){return o.is(j.select2Selector)}return false}};var c={domSelector:".select2.wp-menu-pages-input",count:function(){return this.getElements().length},hasElements:function(){return this.count()>0},getElements:function(){return d(this.domSelector)},getElementOptions:function(o){return o.data()},isBinded:function(o){return o.data("select2")},maybeUnbind:function(o){if(this.isBinded(o)){o.select2("destroy")}},bindAll:function(){var o=this;o.getElements().each(function(){var p=d(this);o.maybeUnbind(p);var q=o.getElementOptions(p);p.select2(q)})},maybeBindAll:function(){if(this.hasElements()){this.bindAll()}},isSelect2:function(o){return i.isSelect2(o)}};var e={TYPE_SUCCESS:"success",TYPE_INFO:"info",TYPE_WARNING:"warning",TYPE_DANGER:"danger",alertsWrapperSelector:".alerts-wrapper",alertTemplate:'<div class="alert alert-{{type}} alert-dismissible fade in" role="alert" style="display: none;"><button type="button" class="close" data-dismiss="alert" aria-label="Close"> <span aria-hidden="true">&times;</span> </button>{{msg}}</div>',alert:function(o,r,q){var p=d(this.getAlertMarkUp(r,o));d(this.alertsWrapperSelector).append(p);p.slideDown("fast");if(q){setTimeout(function(){p.slideUp(function(){p.remove()})},q)}p.alert()},success:function(p,o){this.alert(this.TYPE_SUCCESS,p,o)},info:function(p,o){this.alert(this.TYPE_INFO,p,o)},warning:function(p,o){this.alert(this.TYPE_WARNING,p,o)},danger:function(p,o){this.alert(this.TYPE_DANGER,p,o)},getAlertMarkUp:function(p,o){return this.alertTemplate.replace("{{type}}",o).replace("{{msg}}",p)}};var l={loadingClass:"loading",loading:function(p,r,q){if(!(p instanceof jQuery)){p=d(p)}var o=p.find("i");if(r){o.addClass(this.loadingClass);if(q){p.attr("disabled","disabled")}return}o.removeClass("loading");p.attr("disabled",false)},bindControls:function(){j.getSaveBtn().click(function(o){o.preventDefault();h.saveOptions(a.getActiveTabOptions())});j.getResetBtn().click(function(o){o.preventDefault();h.resetOptions()});j.getTabResetBtn().click(function(o){o.preventDefault();h.resetOptions(a.getActiveTabOptions())});j.getExportBtn().click(function(o){o.preventDefault();h.exportOptions()});j.getImportBtn().click(function(o){o.preventDefault();d("#import-options-input").click()});d("#import-options-input").change(function(p){p.preventDefault();var o=confirm("This will overwrite all current options.\nAre you sure you want to do that?");if(o!=true){return}b.readSingleFileAsText(p.originalEvent,function(r){try{var s=JSON.parse(r.target.result);h.importOptions(s)}catch(q){alert("There was an error reading options file:\n"+q.message)}})});d('a[data-toggle="tab"]').on("shown.bs.tab",function(p){var o=d(p.target);var r=d(p.relatedTarget);var q={state:{active:o.data("title"),inActive:r.data("title")}};c.maybeBindAll();h.updateCoreOptions(q)})}};var h={ajaxUrl:ajaxurl,context:f.context,post:function(r,o,q,s,p){d.ajax({url:this.ajaxUrl,method:"POST",data:r,success:s,complete:o,error:q,dataType:p?p:"json"})},saveOptions:function(t){var r=f.actionSavePrefix+this.context;var q={options:t,action:r,nonce:f.nonce[r]};l.loading(j.getSaveBtn(),true,true);var s=function(v){if(v.data!=undefined&&v.data.options!=undefined){var u=v.data.options;for(var w in u){if(!u.hasOwnProperty(w)){continue}if(u[w].valid){i.markValid(w);continue}i.markInvalid(w,u[w].errors)}}if(v.success==undefined||v.success==false){e.danger("There was an error saving the options");return false}e.success("Options Saved!",2000);return true};var p=function(){e.danger("There was an error saving the options")};var o=function(){l.loading(j.getSaveBtn(),false)};this.post(q,o,p,s)},exportOptions:function(){var r=f.actionExportPrefix+this.context;var q={action:r,nonce:f.nonce[r]};l.loading(j.getExportBtn(),true,true);var s=function(u){if(u.success==undefined||u.success==false){p(u);return false}var t=new Blob([u.data.options],{type:"application/json;charset=utf-8;"});saveAs(t,u.data.name+".json");return true};var o=function(){l.loading(j.getExportBtn(),false)};var p=function(){e.danger("There was an error while trying to prepare your download")};this.post(q,o,p,s)},importOptions:function(t){if(t.length==0){return}var r=f.actionImportPrefix+this.context;var q={action:r,nonce:f.nonce[r],options:t};l.loading(j.getAllControls(),true,true);var s=function(u){if(u.success==undefined||u.success==false){p(u);return false}e.success("Options Import Successful",2000);if(u.data!=undefined&&u.data.options!=undefined){i.updateValues(u.data.options)}return true};var o=function(){l.loading(j.getAllControls(),false)};var p=function(){e.danger("There was an error while importing options")};this.post(q,o,p,s)},resetOptions:function(o){var s=f.actionResetPrefix+this.context;var r={action:s,nonce:f.nonce[s]};if(o){r.include=o}l.loading(j.getResetBtn(),true,true);l.loading(j.getTabResetBtn(),true,true);var t=function(u){if(u.success==undefined||u.success==false){q(u);return false}e.success("All Options Have Been Reset to Defaults",2000);if(u.data!=undefined&&u.data.defaults!=undefined){i.updateValues(u.data.defaults)}return true};var p=function(){l.loading(j.getResetBtn(),false);l.loading(j.getTabResetBtn(),false)};var q=function(){e.danger("There was an error reseting options")};this.post(r,p,q,t)},updateCoreOptions:function(q){var p=f.actionUpdateCoreOptionsPrefix+this.context;var o={options:q,action:p,nonce:f.nonce[p]};this.post(o)}};var k={markup:'<div class="modal fade" tabindex="-1" role="dialog"> <div class="modal-dialog"> <div class="modal-content"> <div class="modal-header"> <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button> <h4 class="modal-title">{{title}}</h4> </div> <div class="modal-body">{{body}} </div> <div class="modal-footer">{{footer}} </div> </div> </div> </div>',getMarkUp:function(p,o,q){return this.markup.replace("{{title}}",p).replace("{{body}}",o).replace("{{footer}}",q)}};d(function(){l.bindControls();var r=d("input.date");var q=d("input.datetime");var p=d("input.month");var o=d("input.time");r.datetimepicker({format:f.dateTimePicker.dateFormat,icons:f.dateTimePicker.icons});q.datetimepicker({format:f.dateTimePicker.dateFormat+" "+f.dateTimePicker.timeFormat,icons:f.dateTimePicker.icons});p.datetimepicker({format:f.dateTimePicker.monthFormat,icons:f.dateTimePicker.icons});o.datetimepicker({format:f.dateTimePicker.timeFormat,icons:f.dateTimePicker.icons})})})(jQuery);